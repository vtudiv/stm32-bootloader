<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Bootloader: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM32 Bootloader
   </div>
   <div id="projectbrief">Customizable Bootloader for STM32 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_r_e_a_d_m_e_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# STM32 Bootloader</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Customizable Bootloader for STM32 microcontrollers. This project includes demonstrations for various hardware how to perform in-application-programming of a firmware located on external SD card with FAT32 file system.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Each example uses the same bootloader library located in the `lib/stm32-bootloader` folder. The examples are located in the `projects` folder and they come with a separate, dedicated README file with description related to that specific implementation.</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Update: the `STM32L496-Discovery` example supports compiling and building the project with the GNU Arm Embedded Toolchain (ARM GCC) out-of-the-box, in addition to IAR EWARM. Check out the project README for further information.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;Please refer to &lt;https://akospasztor.github.io/stm32-bootloader&gt; for complete documentation of the bootloader library source code.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;![Build Status](https://dev.azure.com/akospasztor/stm32-bootloader/_apis/build/status/akospasztor.stm32-bootloader?branchName=master)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;## Table of Contents</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;- [Bootloader features](#bootloader-features)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;- [Source code organization](#source-code-organization)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;- [Examples](#examples)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;- [How to use](#how-to-use)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;- [Configuration](#configuration)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;- [References](#references)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;## Bootloader features</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;- Configurable application space</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;- Flash erase</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;- Flash programming</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;- Flash verification after programming</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;- Checksum verification</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;- Flash protection check, write protection enable/disable</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;- Extended error handling, fail-safe design</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;- Bootloader firmware update and the ability to perform full chip re-programming: enter ST&#39;s built-in bootloader from software (without triggering the BOOT pin)</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;- Serial tracing over SWO for easier debugging and development</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;- Easy to customize and port to other microcontrollers</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;## Source code organization</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;```</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;Repository</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;├── docs</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;├── drivers</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;│   ├── CMSIS</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;│   └── STM32L4xx_HAL_Driver</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;├── lib</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;│   ├── fatfs</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;│   └── stm32-bootloader</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;└── projects</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    ├── STM32L476-CustomHw</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    ├── STM32L496-CustomHw</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    └── STM32L496-Discovery</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;```</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;The `docs` folder contains the generated documentation of the bootloader source code and other documentation-related static files.</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;The `drivers` folder contains the CMSIS (Cortex Microcontroller Software Interface Standard) as well as the HAL (Hardware Abstraction Layer) drivers from ST.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;The bootloader source code and corresponding header file can be found in `lib/stm32-bootloader` folder. Additionally, the `lib` folder contains the FatFs library as well.</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;The various demonstrations reside in the `projects` folder. Each example project contains an `include` and `source` folder where the header and source files are located respectively. The compiler and SDK-specific files are located in their respective subfolders. Furthermore, every example project has a dedicated README file explaining its functionality in detail.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;## Examples</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;This repository contains the following examples.</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;|Microcontroller |Hardware           |Project path                 |</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;|----------------|-------------------|-----------------------------|</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;|STM32L476VG     |Custom             |projects/STM32L476-CustomHw  |</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;|STM32L496VG     |Custom             |projects/STM32L496-CustomHw  |</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;|STM32L496AG     |[32L496GDISCOVERY] |projects/STM32L496-Discovery |</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;[32L496GDISCOVERY]: https://www.st.com/en/evaluation-tools/32l496gdiscovery.html</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;## How to use</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;The bootloader can be easily customized and tailored to the required hardware and environment, i.e. to perform firmware updates over various interfaces or even to implement over-the-air (OTA) updates if the hardware incorporates wireless communication modules. In order to perform successful in-application-programming, the following sequence has to be kept:</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;1. Check for flash write protection and disable it if necessary.</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;2. Initialize flash with `Bootloader_Init()`.</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;3. Erase application space with `Bootloader_Erase()`.</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;4. Prepare for programming by calling `Bootloader_FlashBegin()`.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;5. Perform programming by repeatedly calling the `Bootloader_FlashNext()` function. The programming procedure requires 8 bytes of data (double word) to be programmed at once into the flash. This function automatically increases the address where the data is being written.</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;6. Finalize programming by calling `Bootloader_FlashEnd()`.</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;The application image has to be in binary format. If the checksum verification is enabled, the binary must include the checksum value at the end of the image. When creating the application image, the checksum has to be calculated over the entire image (except the checksum area) with the following parameters:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;- Algorithm: CRC32</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;- Size: 4 bytes</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;- Initial value: 0xFFFFFFFF</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;- Bit order: MSB first</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;__Important notes__:</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;- In order to perform a successful application jump from the bootloader, the vector table of the application firmware should be relocated. On system reset, the vector table is fixed at address 0x00000000. When creating an application, the microcontroller startup code sets the vector table offset to 0x0000 in the `system_stm32xxxx.c` file by default. This has to be either disabled (the bootloader can be configured to perform the vector table relocation before the jump) or manually set the vector table offset register (VTOR) to the appropriate offset value which is the start address of the application space. For more information, please refer to [[1]](#references).</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;- The linker settings of the application firmware need to be adjusted from their default settings so that the start address of flash reflects the actual start address of the application space.</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;## Configuration</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;The bootloader can be widely configured in the `bootloader.h` file. The file includes detailed comments and descriptions related to the configurable parameters and definitions.</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;## References</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;[1] PM0214, &quot;STM32F3 Series, STM32F4 Series, STM32L4 Series and STM32L4+ Series Cortex®-M4 Programming Manual&quot;, http://www.st.com/resource/en/programming_manual/dm00046982.pdf</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>README.md</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
